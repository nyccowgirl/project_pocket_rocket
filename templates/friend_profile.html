{% extends 'base.html' %}
{% block content %}

  <h1>Friend's Profile</h1>

  <!-- TO DO: Set each as either menu item on left panel or as scroll down from nav bar. -->


    <div>
      {% if friend.user_pic %}
        <img id='user_pic' src='{{ friend.user_pic }}' hspace='40' align='left'>
      {% else %}
        <img id ='user_pic' src='/static/img/dragonfly_friend.jpeg' hspace='40' align='left'>
      {% endif %}
    </div>
     <h2>{{ friend.username }}</h2>
  </div>

  <hr>

  <div class='container-fluid'>

  <button type='button' class='btn btn-unique btn-rounded waves-light' (click)='form.show()' data-toggle='modal' data-target='#modalAddFriend' mdbRippleRadius>Add A Friend</button>

  <!--Modal: Login with Avatar Form-->
  <form action='/add-friend' method='POST' mdbModal #form='mdb-modal' class='modal fade' id='modalAddFriend' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
      <div class='modal-dialog cascading-modal modal-avatar modal-lg' role='document'>
          <!--Content-->
          <div class='modal-content'>

              <!--Header-->
              <div class='modal-header'>
                  <img src='/static/img/pinky.jpg' class='rounded-circle img-responsive' height='125' width='125'>
              </div>
              <!--Body-->
              <div class='modal-body text-center mb-1'>

                  <h5 class='mt-1 mb-2'>My BFF</h5>

                  <div class='md-form ml-0 mr-0'>
<!--                       <i class='fa fa-envelope prefix'></i>
 -->                      <input mdbActive type='text' id='friend-email' name='friend-email' class='form-control ml-0'>
                      <label for='friend-email' class='ml-0'>Enter Email</label>
                  </div>

                  <div class='text-center'>
                      <button class='btn btn-unique mt-1 waves-light' mdbRippleRadius>Send <i class='fa fa-send ml-1'></i></button>
                  </div>
              </div>

          </div>
          <!--/.Content-->
      </div>
  </form>
  <!--Modal: Login with Avatar Form-->
  </div>

  <hr>
  <h3>About {{ friend.username }}</h3>
    <div>
      <ul>
        First Name: {{ friend.first_name }}<br>
        Last Name: {{ friend.last_name }}<br>
        User Name: {{ friend.username }}<br>
        Member Since: {{ friend.join_date|datetimeformat('%b %Y') }}<br>
    </div>

  <h3>Zir Digits</h3>

    <div>
      <ul>
        Check-Ins: {{ friend.tot_checkins() }}</br>
        Reviews: {{ friend.tot_reviews() }}</br>
        Referrals: {{ friend.tot_refs() }} | Redeemed: {{ friend.tot_refs_reds() }}</br>
        Promos Redeemed: {{ friend.tot_reds() }}</br>
        Friends: {{ friend.tot_friends() }}</br>
        Total Businesses Visited: {{ friend.tot_unique_biz() }}</br>
        Total Businesses Referred to Friends: {{ friend.tot_biz_referrals() }}</br>
      </ul>
    </div>

  {% if friend.friends %}
    <h3>Zir Friends</h3>

    <ul>
    {% for friend in friend.friends|sort(attribute='username') %}
      <li>
        {% if friend.user_id == session['user_id'] %}
          <a href='/user-profile'> {{ friend.username }}</a>
        {% else %}
          <a href='/friend-profile/{{ friend.user_id }}'>{{ friend.username }}</a>
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  {% endif %}

  {% if friend.reviews %}
    <h3>Zir Reviews</h3>

    <ul>
    {% for review in friend.reviews|sort(attribute='review_date') %}
      <li>
        <a href='/business_profile/{{ review.biz.biz_name }}'>{{ review.biz.biz_name}}</a>
        {% if review.revise_review %}
          <p>Updated Rating: {{ review.new_rating }} | Date: {{ review.review_date|datetimeformat('%d %b %Y') }} | Total Likes: {{ review.tot_likes() }} |
            {% if review.has_liked(session['user_id']) %}
              <button disabled><i class="fa fa-heart" aria-hidden="true"></i></button>
            {% else %}
              <button id='{{ review.review_id }}' class='like' data-review-id='{{ review.review_id }}'><i class="fa fa-heart-o" aria-hidden="true"></i></button>
            {% endif %}
          <p>{{ review.new_review }}</p>
        {% else %}
          <p>Rating: {{ review.rating }} | Date: {{ review.review_date|datetimeformat('%d %b %Y') }} | Total Likes: {{ review.tot_likes() }} |
            {% if review.has_liked(session['user_id']) %}
              <button disabled><i class="fa fa-heart" aria-hidden="true"></i></button>
            {% else %}
              <button id='{{ review.review_id }}' class='like' data-review-id='{{ review.review_id }}'><i class="fa fa-heart-o" aria-hidden="true"></i></button>
            {% endif %}
          <p>{{ review.review }}</p>
        {% endif %}
        {% if review.dispute %}
          <b style='color: #880e4f'>Comment from
            {% if review.biz.users %}
              {{ review.biz.users[0].username }},
            {% endif %}
             owner of {{ review.biz.biz_name }}</b>
          <p>{{ review.response }}</p>
          {% if review.cust_svc %}
            <b><i>Customer Service Rating: </i>{{ review.cust_svc }}</b>
          {% endif %}
          {% if review.revise_review %}
            <p><i>Original Rating: </i>{{ review.rating }}</p>
            <p>{{ review.review }}</p>
          {% endif %}
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  {% endif %}
  <!-- TO DO: Add total likes per review -->

  {% if friend.biz %}
    <h3>Zir Business(es)</h3>

    <ul>
    {% for biz in friend.biz %}
      <li><a href='/business_profile{{ biz.biz_id }}'>{{ biz.biz_name }}</a></li>
    {% endfor %}
    </ul>
  {% endif %}

{% endblock %}

{% block script %}

{% endblock %}